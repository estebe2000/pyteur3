"use strict";(self.webpackChunk_basthon_basthon_console=self.webpackChunk_basthon_basthon_console||[]).push([[211],{9158:(e,t,r)=>{r.d(t,{Ij:()=>i,fI:()=>c.f,p:()=>l.p,k0:()=>l.k0});var s=r(4590),a=r(1838),o=r(2575),n=r(9610);(0,a.t)(),(0,a.Te)();class i extends o.z{constructor(e){super(e),this._channelSyncer=new n.D,this._encrypt=e=>e,this._legacy=!0===e?.legacy,this.isLegacy()||(globalThis.crossOriginIsolated?this._sab=new SharedArrayBuffer(1024):this._fallbackKey=globalThis.crypto.randomUUID())}isLegacy(){return this._legacy}syncCommSupport(){return null!=this._sab}safeKernel(){return!this.isLegacy()}newWorker(){throw new a.EH("newWorker")}async importLegacyWorker(){throw new a.EH("importLegacyWorker")}async setupWorker(){const e=new MessageChannel;if(this.isLegacy())self._commPort=e.port1,self._assetsURL=this.assetsURL(!0),await this.importLegacyWorker();else{const t=this.newWorker();t.postMessage(e.port1,[e.port1]),this._worker=t}const t=(0,s.LV)(e.port2);this._remote=await new t(this._options);const{port1:r,port2:a}=new MessageChannel;a.onmessage=e=>this.processWorkerMessage(e.data),this.postMessageToWorker=a.postMessage.bind(a),await(this.remote?.setCommPort((0,s.k0)(r,[r])))}async _start(){if(await super._start(),this.isLegacy()&&null!=this.remote)return void await(this.remote?.legacyStart());const e=new Worker(new URL(r.p+r.u(450),r.b)),t=(0,s.LV)(e);if(await this.setupWorker(),this.syncCommSupport())console.log("Using SharedArrayBuffer for synchronous worker communication."),await(this._remote?.setSAB(this._sab));else if(null!=this._fallbackKey){console.warn("SharedArrayBuffer not available, falling back to using third-party server for synchronous worker communication.");const e=globalThis.crypto.randomUUID();await(this.remote?.setFallbackKeyAndPass(this._fallbackKey,e));const t=await Promise.all([r.e(955),r.e(477)]).then(r.t.bind(r,955,23));this._encrypt=r=>t.encrypt(r,e).toString()}const a=await t[s.UD]();await(this.remote?.setProxyPort((0,s.k0)(a,[a]))),await(this.remote?.init())}get remote(){return this._remote}async _stop(){this.isLegacy()?await(this.remote?.legacyStop()):(this._worker?.terminate(),this._worker=void 0,this._remote=void 0),await super._stop()}async processWorkerMessage(e){switch(e.type){case"eval-end":this._channelSyncer.resolve(),this._channelSyncer=new n.D;break;case"stream":const{stream:t,text:r}=e.content,s=this.clone(e.data);s.stream=t,s.content=r,this.dispatchEvent("eval.output",s);break;case"download":const{content:a,filename:o}=e.content;this.download(a,o);break;case"display":if("dom-node"===e.data?.display_type){if(!this.isLegacy())throw new Error("internal error");const t=e.data?.content;e.data.content=await(self.basthon?.popDOMNode(t))}this.dispatchEvent("eval.display",e.data);break;case"clear_output":this.dispatchEvent("eval.clear-output",e.data);break;case"input":const{prompt:i,password:c,data:l}=e.content,h=await this.inputAsync(i,c,l);if(!0===e.content.toplevel)this.postMessageToWorker({type:"toplevel-input",content:h,data:l});else if(this.syncCommSupport()){const e=(new TextEncoder).encode(h);new Uint8Array(this._sab).set(e.subarray(0,this._sab.byteLength)),Atomics.notify(new Int32Array(this._sab),0,1)}else{const e=await fetch("https://api.basthon.fr/ephemeral",{method:"POST",headers:{"X-API-Referer":self.location.href},body:JSON.stringify({action:"post",key:this._fallbackKey,payload:this._encrypt(h)})});if(!e.ok)throw new Error(`Basthon's network API error: ${e.status}`)}break;case"breakpoint-move-on":const p=Jupyter?.notebook,u=e.content.data?.parent_msg?.header?.msg_id,m=p?.last_msg_id_to_cell_index?.(u);p?.next_breakpoint_cell?.(m)}}async evalAsync(e,t,r,s=null){s.interactive=!0,this._execution_count++;const a=this._channelSyncer.promise,o=await(this.remote?.eval(s,e));let n;return await a,"ok"===o?.status&&(n=o.result),[n,this._execution_count]}async putFile(e,t){await super.putFile(e,t),await(this.remote?.putFile(e,t))}async putModule(e,t){await super.putModule(e,t),await(this.remote?.putModule(e,t))}async complete(e){return await(this.remote?.complete(e))??[]}async more(e){return await(this.remote?.more(e))??!1}}var c=r(2577),l=r(9365)},211:(e,t,r)=>{r.d(t,{Python3Kernel:()=>a});var s=r(9158);class a extends s.Ij{constructor(e){super(e)}newWorker(){return new Worker(new URL(r.p+r.u(412),r.b),{sandboxed:!0})}async importLegacyWorker(){await r.e(31).then(r.bind(r,6412))}language(){return"python3"}languageName(){return"Python 3"}moduleExts(){return["py"]}async readdir(e){if(null==this.remote)throw new Error("Can't access remote kernel!");return await this.remote.readdir(e)}async chdir(e){if(null==this.remote)throw new Error("Can't access remote kernel!");return await this.remote.chdir(e)}async mkdir(e){if(null==this.remote)throw new Error("Can't access remote kernel!");return await this.remote.mkdir(e)}async userModules(){if(null==this.remote)throw new Error("Can't access remote kernel!");return await this.remote.userModules()}async getFile(e){if(null==this.remote)throw new Error("Can't access remote kernel!");return await this.remote.getFile(e)}async getUserModuleFile(e){if(null==this.remote)throw new Error("Can't access remote kernel!");return await this.remote.getUserModuleFile(e)}banner(){return'Python 3.11.2 (main, May  3 2023 04:00:05) on WebAssembly/Emscripten\nType "help", "copyright", "credits" or "license" for more information.'}}}}]);
//# sourceMappingURL=211.10e378868bd3a00a8bb2.js.map