"use strict";(self.webpackChunk_basthon_basthon_console=self.webpackChunk_basthon_basthon_console||[]).push([[719],{1838:(e,t,s)=>{s.d(t,{EH:()=>n,JQ:()=>a,Te:()=>l,t:()=>c});class n extends Error{constructor(e){super(`Function ${e} not implemented!`),this.name="NotImplementedError"}}const r=async e=>await new Promise(((t,s)=>{const n=new FileReader;n.onloadend=()=>{t(n.result)},n.onerror=s,n.readAsDataURL(new Blob([e]))})),o=async(e,t)=>{const s=e,n=t.slice(s.length);let o=null;const i={status:200,statusText:"OK",headers:new Headers};try{o=await self.basthon.getFile(n);const e=await r(o),t=e.substring(e.indexOf(":")+1,e.indexOf(";"));o=o.buffer,i.headers.append("Content-Type",t),i.headers.append("Content-Length",o.byteLength)}catch(e){i.status=404,i.statusText="Not Found"}return new Response(o,i)},i=e=>new URL(e).origin,a=e=>{if("mockedFetch"===self.fetch.name)return;const t=self.fetch,s=self._assetsURL;self.fetch=async function(n,r){const a=(n=new Request(n,r)).url,c="filesystem:/";if(e)return a.startsWith(c)?await o(c,a):await t(n);if(null==self.importScripts||null==s)return Response.error();n=new Request(n,{credentials:"omit"});try{if(a.startsWith(c))return await o(c,a);if(i(a)===i(s)){if((e=>{const t=new URL(e).href;return t.substring(0,t.lastIndexOf("/"))})(a).startsWith(s)){const e=self._remoteProxy,{body:t,options:s}=await e.fetch(n);return new Response(t,s)}throw new Error("Ressource is outside the proxy' scope")}return await t(n)}catch(e){return console.error(`security proxy: request to ${a} throw error: ${e.toString()}`),Response.error()}}},c=()=>{if("SandboxedWorker"!==globalThis.Worker.name){class e extends Worker{constructor(e,t){if(!0===t?.sandboxed){const t=new URL(e).href,s=`\n           self._assetsURL = "${t.substring(0,t.lastIndexOf("/"))}";\n           globalThis = {importScripts: self.importScripts, location: "${e}"};\n           importScripts("${e}");\n           globalThis = self;\n        `.replace(/\s/g,"");super(`data:text/javascript;base64,${btoa(s)}`)}else super(e,t)}}globalThis.Worker=e}},l=()=>{if(null==globalThis?.HTMLImageElement)return;const e=Object.getOwnPropertyDescriptor(HTMLImageElement.prototype,"src");"mockedSrcSet"!==e?.set?.name&&Object.defineProperty(HTMLImageElement.prototype,"src",{...e,get:function(){return e?.get?.call(this)},set:function(t){if(t.startsWith("filesystem:/")){const s=t.slice(12);(async()=>{const t=(await(globalThis.Basthon?.getFile?.(s)))?.buffer;e?.set?.call(this,await r(t))})()}else e?.set?.call(this,t)}})}},2575:(e,t,s)=>{s.d(t,{z:()=>a});var n=s(9610),r=s(1236),o=s(1838);class i extends Event{constructor(e,t){super(e),this.detail=t}}class a{constructor(e){this._isReady=!1,this._ready=new n.D,this._stopped=Promise.resolve(),this._execution_count=0,this._pendingInput=void 0,this._listeners=new Map,this._files=new Map,this._modules=new Map,this._options=this.clone(e),this._rootPath=e.rootPath}safeKernel(){return!1}version(){return r.x}language(){throw new o.EH("language")}languageName(){throw new o.EH("languageName")}moduleExts(){throw new o.EH("moduleExts")}get execution_count(){return this._execution_count}evalAsync(e,t,s,n=null){throw new o.EH("evalAsync")}async putFile(e,t){this._files.set(e,t)}async putModule(e,t){this._modules.set(e,t)}async userModules(){return[]}async getFile(e){throw new o.EH("getFile")}async getUserModuleFile(e){throw new o.EH("getUserModuleFile")}async more(e){throw new o.EH("more")}async complete(e){return[]}banner(){return`Welcome to the ${this.languageName()} REPL!`}ps1(){return">>> "}ps2(){return"... "}async _init(){}async init(){this.safeKernel()||console.warn("%c⚠ DANGER ⚠: this kernel is not safe! Please consider using a safe kernel.","color: red; font-size: 20px;");try{await this._init()}catch(e){throw this._ready.reject(e),e}this.addEventListener("eval.request",this.evalFromEvent.bind(this)),await this.start()}async _start(){}async start(){await this._stopped,this._execution_count=0;try{await this._start()}catch(e){throw this._ready.reject(e),e}this._files.forEach(((e,t)=>this.putFile(t,e))),this._modules.forEach(((e,t)=>this.putModule(t,e))),this._isReady=!0,this._ready.resolve()}async _stop(){}stop(){this._isReady=!1,this._ready=new n.D,this._stopped=this._stop()}restart(){this.stop(),this.start()}get isReady(){return this._isReady}async ready(){return this._ready.promise}assetsURL(e=!1){let t=this._rootPath;if(e&&!t.startsWith("http")){const e=window.location.origin+window.location.pathname;t=e.substring(0,e.lastIndexOf("/"))+"/"+t}return t}basthonRoot(e=!1){return this.assetsURL(e)+"/"+this.version()+"/"+this.language()}download(e,t){if(!("string"==typeof e||e instanceof String)){const t=new Blob([e],{type:"application/octet-stream"});e=window.URL.createObjectURL(t)}const s=document.createElement("a");s.download=t,s.href=e,s.target="_blank",s.style.display="none",document.body.appendChild(s),s.click(),document.body.removeChild(s)}dispatchEvent(e,t){document.dispatchEvent(new i(`basthon.${e}`,t))}addEventListener(e,t){const s=e=>t(e.detail);document.addEventListener(`basthon.${e}`,s);let n=this._listeners.get(e);null==n&&(n=new Map,this._listeners.set(e,n)),n.set(t,s)}removeEventListener(e,t){const s=this._listeners.get(e);document.removeEventListener(`basthon.${e}`,s?.get(t))}async inputAsync(e,t=!1,s=void 0){(s=this.clone(s)).content={prompt:e,password:t};const r=new n.D;s.resolve=r.resolve.bind(r),s.reject=r.reject.bind(r),this._pendingInput=r,this.dispatchEvent("eval.input",s);const o=await r.promise;return this._pendingInput=void 0,o}resolvePendingInput(){this._pendingInput?.resolve("")}clone(e){return JSON.parse(JSON.stringify(e))}async putRessource(e,t){const s=e.split(".").pop()??"";return this.moduleExts().includes(s)?await this.putModule(e,t):await this.putFile(e,t)}pendingInput(){return null!=this._pendingInput}async evalFromEvent(e){const t=t=>s=>{let n=this.clone(e);n.stream=t,n.content=s,this.dispatchEvent("eval.output",n)},s=t("stdout"),n=t("stderr");let r;try{r=await this.evalAsync(e.code,s,n,e)}catch(t){n(t.toString());const s=this.clone(e);return s.error=t,s.execution_count=this.execution_count,void this.dispatchEvent("eval.error",s)}if(null==r)return;const o=r[0],i=r[1];let a=this.clone(e);a.execution_count=i,null!=o&&(a.result=o),this.dispatchEvent("eval.finished",a)}}},1236:(e,t,s)=>{s.d(t,{x:()=>n});const n="0.73.2"},719:(e,t,s)=>{s.d(t,{EchoKernel:()=>r});var n=s(2575);class r extends n.z{constructor(e){super(e)}language(){return"echo"}languageName(){return"Echo"}moduleExts(){return[]}ps1(){return"echo> "}ps2(){return"...> "}async more(e){return!1}async evalAsync(e,t,s,n=null){return n.interactive=!0,this._execution_count++,t(e+"\n"),[void 0,this._execution_count]}}}}]);
//# sourceMappingURL=719.3635c9eb1261f8fd6fb3.js.map