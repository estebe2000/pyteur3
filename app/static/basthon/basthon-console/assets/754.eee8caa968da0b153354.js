"use strict";(self.webpackChunk_basthon_basthon_console=self.webpackChunk_basthon_basthon_console||[]).push([[754],{9158:(e,t,s)=>{s.d(t,{Ij:()=>i,fI:()=>c.f,p:()=>l.p,k0:()=>l.k0});var a=s(4590),r=s(1838),o=s(2575),n=s(9610);(0,r.t)(),(0,r.Te)();class i extends o.z{constructor(e){super(e),this._channelSyncer=new n.D,this._encrypt=e=>e,this._legacy=!0===e?.legacy,this.isLegacy()||(globalThis.crossOriginIsolated?this._sab=new SharedArrayBuffer(1024):this._fallbackKey=globalThis.crypto.randomUUID())}isLegacy(){return this._legacy}syncCommSupport(){return null!=this._sab}safeKernel(){return!this.isLegacy()}newWorker(){throw new r.EH("newWorker")}async importLegacyWorker(){throw new r.EH("importLegacyWorker")}async setupWorker(){const e=new MessageChannel;if(this.isLegacy())self._commPort=e.port1,self._assetsURL=this.assetsURL(!0),await this.importLegacyWorker();else{const t=this.newWorker();t.postMessage(e.port1,[e.port1]),this._worker=t}const t=(0,a.LV)(e.port2);this._remote=await new t(this._options);const{port1:s,port2:r}=new MessageChannel;r.onmessage=e=>this.processWorkerMessage(e.data),this.postMessageToWorker=r.postMessage.bind(r),await(this.remote?.setCommPort((0,a.k0)(s,[s])))}async _start(){if(await super._start(),this.isLegacy()&&null!=this.remote)return void await(this.remote?.legacyStart());const e=new Worker(new URL(s.p+s.u(450),s.b)),t=(0,a.LV)(e);if(await this.setupWorker(),this.syncCommSupport())console.log("Using SharedArrayBuffer for synchronous worker communication."),await(this._remote?.setSAB(this._sab));else if(null!=this._fallbackKey){console.warn("SharedArrayBuffer not available, falling back to using third-party server for synchronous worker communication.");const e=globalThis.crypto.randomUUID();await(this.remote?.setFallbackKeyAndPass(this._fallbackKey,e));const t=await Promise.all([s.e(955),s.e(477)]).then(s.t.bind(s,955,23));this._encrypt=s=>t.encrypt(s,e).toString()}const r=await t[a.UD]();await(this.remote?.setProxyPort((0,a.k0)(r,[r]))),await(this.remote?.init())}get remote(){return this._remote}async _stop(){this.isLegacy()?await(this.remote?.legacyStop()):(this._worker?.terminate(),this._worker=void 0,this._remote=void 0),await super._stop()}async processWorkerMessage(e){switch(e.type){case"eval-end":this._channelSyncer.resolve(),this._channelSyncer=new n.D;break;case"stream":const{stream:t,text:s}=e.content,a=this.clone(e.data);a.stream=t,a.content=s,this.dispatchEvent("eval.output",a);break;case"download":const{content:r,filename:o}=e.content;this.download(r,o);break;case"display":if("dom-node"===e.data?.display_type){if(!this.isLegacy())throw new Error("internal error");const t=e.data?.content;e.data.content=await(self.basthon?.popDOMNode(t))}this.dispatchEvent("eval.display",e.data);break;case"clear_output":this.dispatchEvent("eval.clear-output",e.data);break;case"input":const{prompt:i,password:c,data:l}=e.content,h=await this.inputAsync(i,c,l);if(!0===e.content.toplevel)this.postMessageToWorker({type:"toplevel-input",content:h,data:l});else if(this.syncCommSupport()){const e=(new TextEncoder).encode(h);new Uint8Array(this._sab).set(e.subarray(0,this._sab.byteLength)),Atomics.notify(new Int32Array(this._sab),0,1)}else{const e=await fetch("https://api.basthon.fr/ephemeral",{method:"POST",headers:{"X-API-Referer":self.location.href},body:JSON.stringify({action:"post",key:this._fallbackKey,payload:this._encrypt(h)})});if(!e.ok)throw new Error(`Basthon's network API error: ${e.status}`)}break;case"breakpoint-move-on":const p=Jupyter?.notebook,u=e.content.data?.parent_msg?.header?.msg_id,y=p?.last_msg_id_to_cell_index?.(u);p?.next_breakpoint_cell?.(y)}}async evalAsync(e,t,s,a=null){a.interactive=!0,this._execution_count++;const r=this._channelSyncer.promise,o=await(this.remote?.eval(a,e));let n;return await r,"ok"===o?.status&&(n=o.result),[n,this._execution_count]}async putFile(e,t){await super.putFile(e,t),await(this.remote?.putFile(e,t))}async putModule(e,t){await super.putModule(e,t),await(this.remote?.putModule(e,t))}async complete(e){return await(this.remote?.complete(e))??[]}async more(e){return await(this.remote?.more(e))??!1}}var c=s(2577),l=s(9365)},2754:(e,t,s)=>{s.d(t,{SQLKernel:()=>r});var a=s(9158);class r extends a.Ij{constructor(e){super(e)}newWorker(){return new Worker(new URL(s.p+s.u(143),s.b),{sandboxed:!0})}async importLegacyWorker(){await Promise.all([s.e(479),s.e(69),s.e(524)]).then(s.bind(s,8937))}language(){return"sql"}languageName(){return"SQL"}moduleExts(){return["sql","db","sqlite"]}ps1(){return"sql> "}ps2(){return"...> "}}}}]);
//# sourceMappingURL=754.eee8caa968da0b153354.js.map