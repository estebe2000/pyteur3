"use strict";(self.webpackChunk_basthon_basthon_notebook=self.webpackChunk_basthon_basthon_notebook||[]).push([[4097],{59158:(t,e,s)=>{s.d(e,{Ij:()=>i,fI:()=>c.f,p:()=>h.p,k0:()=>h.k0});var a=s(14590),r=s(51838),o=s(42575),n=s(69610);(0,r.t)(),(0,r.Te)();class i extends o.z{constructor(t){super(t),this._channelSyncer=new n.D,this._encrypt=t=>t,this._legacy=!0===t?.legacy,this.isLegacy()||(globalThis.crossOriginIsolated?this._sab=new SharedArrayBuffer(1024):this._fallbackKey=globalThis.crypto.randomUUID())}isLegacy(){return this._legacy}syncCommSupport(){return null!=this._sab}safeKernel(){return!this.isLegacy()}newWorker(){throw new r.EH("newWorker")}async importLegacyWorker(){throw new r.EH("importLegacyWorker")}async setupWorker(){const t=new MessageChannel;if(this.isLegacy())self._commPort=t.port1,self._assetsURL=this.assetsURL(!0),await this.importLegacyWorker();else{const e=this.newWorker();e.postMessage(t.port1,[t.port1]),this._worker=e}const e=(0,a.LV)(t.port2);this._remote=await new e(this._options);const{port1:s,port2:r}=new MessageChannel;r.onmessage=t=>this.processWorkerMessage(t.data),this.postMessageToWorker=r.postMessage.bind(r),await(this.remote?.setCommPort((0,a.k0)(s,[s])))}async _start(){if(await super._start(),this.isLegacy()&&null!=this.remote)return void await(this.remote?.legacyStart());const t=new Worker(new URL(s.p+s.u(4069),s.b)),e=(0,a.LV)(t);if(await this.setupWorker(),this.syncCommSupport())console.log("Using SharedArrayBuffer for synchronous worker communication."),await(this._remote?.setSAB(this._sab));else if(null!=this._fallbackKey){console.warn("SharedArrayBuffer not available, falling back to using third-party server for synchronous worker communication.");const t=globalThis.crypto.randomUUID();await(this.remote?.setFallbackKeyAndPass(this._fallbackKey,t));const e=await Promise.all([s.e(955),s.e(477)]).then(s.t.bind(s,40955,23));this._encrypt=s=>e.encrypt(s,t).toString()}const r=await e[a.UD]();await(this.remote?.setProxyPort((0,a.k0)(r,[r]))),await(this.remote?.init())}get remote(){return this._remote}async _stop(){this.isLegacy()?await(this.remote?.legacyStop()):(this._worker?.terminate(),this._worker=void 0,this._remote=void 0),await super._stop()}async processWorkerMessage(t){switch(t.type){case"eval-end":this._channelSyncer.resolve(),this._channelSyncer=new n.D;break;case"stream":const{stream:e,text:s}=t.content,a=this.clone(t.data);a.stream=e,a.content=s,this.dispatchEvent("eval.output",a);break;case"download":const{content:r,filename:o}=t.content;this.download(r,o);break;case"display":if("dom-node"===t.data?.display_type){if(!this.isLegacy())throw new Error("internal error");const e=t.data?.content;t.data.content=await(self.basthon?.popDOMNode(e))}this.dispatchEvent("eval.display",t.data);break;case"clear_output":this.dispatchEvent("eval.clear-output",t.data);break;case"input":const{prompt:i,password:c,data:h}=t.content,l=await this.inputAsync(i,c,h);if(!0===t.content.toplevel)this.postMessageToWorker({type:"toplevel-input",content:l,data:h});else if(this.syncCommSupport()){const t=(new TextEncoder).encode(l);new Uint8Array(this._sab).set(t.subarray(0,this._sab.byteLength)),Atomics.notify(new Int32Array(this._sab),0,1)}else{const t=await fetch("https://api.basthon.fr/ephemeral",{method:"POST",headers:{"X-API-Referer":self.location.href},body:JSON.stringify({action:"post",key:this._fallbackKey,payload:this._encrypt(l)})});if(!t.ok)throw new Error(`Basthon's network API error: ${t.status}`)}break;case"breakpoint-move-on":const p=Jupyter?.notebook,u=t.content.data?.parent_msg?.content?.cell_id;p?.next_breakpoint_cell?.(u)}}async evalAsync(t,e,s,a=null){a.interactive=!0,this._execution_count++;const r=this._channelSyncer.promise,o=await(this.remote?.eval(a,t));let n;return await r,"ok"===o?.status&&(n=o.result),[n,this._execution_count]}async putFile(t,e){await super.putFile(t,e),await(this.remote?.putFile(t,e))}async putModule(t,e){await super.putModule(t,e),await(this.remote?.putModule(t,e))}async complete(t){return await(this.remote?.complete(t))??[]}async more(t){return await(this.remote?.more(t))??!1}}var c=s(42577),h=s(89365)},4097:(t,e,s)=>{s.d(e,{JavaScriptKernel:()=>r});var a=s(59158);class r extends a.Ij{constructor(t){super(t)}newWorker(){return new Worker(new URL(s.p+s.u(3423),s.b),{sandboxed:!0})}async importLegacyWorker(){await Promise.all([s.e(6966),s.e(5804)]).then(s.bind(s,62010))}language(){return"javascript"}languageName(){return"Javascript"}moduleExts(){return["js"]}ps1(){return" js> "}ps2(){return"...> "}}}}]);
//# sourceMappingURL=4097.63ea92f89a60c4b718cd.js.map