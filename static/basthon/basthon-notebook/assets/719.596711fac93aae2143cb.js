"use strict";(self.webpackChunk_basthon_basthon_notebook=self.webpackChunk_basthon_basthon_notebook||[]).push([[719],{51838:(t,e,s)=>{s.d(e,{EH:()=>n,JQ:()=>a,Te:()=>l,t:()=>c});class n extends Error{constructor(t){super(`Function ${t} not implemented!`),this.name="NotImplementedError"}}const r=async t=>await new Promise(((e,s)=>{const n=new FileReader;n.onloadend=()=>{e(n.result)},n.onerror=s,n.readAsDataURL(new Blob([t]))})),o=async(t,e)=>{const s=t,n=e.slice(s.length);let o=null;const i={status:200,statusText:"OK",headers:new Headers};try{o=await self.basthon.getFile(n);const t=await r(o),e=t.substring(t.indexOf(":")+1,t.indexOf(";"));o=o.buffer,i.headers.append("Content-Type",e),i.headers.append("Content-Length",o.byteLength)}catch(t){i.status=404,i.statusText="Not Found"}return new Response(o,i)},i=t=>new URL(t).origin,a=t=>{if("mockedFetch"===self.fetch.name)return;const e=self.fetch,s=self._assetsURL;self.fetch=async function(n,r){const a=(n=new Request(n,r)).url,c="filesystem:/";if(t)return a.startsWith(c)?await o(c,a):await e(n);if(null==self.importScripts||null==s)return Response.error();n=new Request(n,{credentials:"omit"});try{if(a.startsWith(c))return await o(c,a);if(i(a)===i(s)){if((t=>{const e=new URL(t).href;return e.substring(0,e.lastIndexOf("/"))})(a).startsWith(s)){const t=self._remoteProxy,{body:e,options:s}=await t.fetch(n);return new Response(e,s)}throw new Error("Ressource is outside the proxy' scope")}return await e(n)}catch(t){return console.error(`security proxy: request to ${a} throw error: ${t.toString()}`),Response.error()}}},c=()=>{if("SandboxedWorker"!==globalThis.Worker.name){class t extends Worker{constructor(t,e){if(!0===e?.sandboxed){const e=new URL(t).href,s=`\n           self._assetsURL = "${e.substring(0,e.lastIndexOf("/"))}";\n           globalThis = {importScripts: self.importScripts, location: "${t}"};\n           importScripts("${t}");\n           globalThis = self;\n        `.replace(/\s/g,"");super(`data:text/javascript;base64,${btoa(s)}`)}else super(t,e)}}globalThis.Worker=t}},l=()=>{if(null==globalThis?.HTMLImageElement)return;const t=Object.getOwnPropertyDescriptor(HTMLImageElement.prototype,"src");"mockedSrcSet"!==t?.set?.name&&Object.defineProperty(HTMLImageElement.prototype,"src",{...t,get:function(){return t?.get?.call(this)},set:function(e){if(e.startsWith("filesystem:/")){const s=e.slice(12);(async()=>{const e=(await(globalThis.Basthon?.getFile?.(s)))?.buffer;t?.set?.call(this,await r(e))})()}else t?.set?.call(this,e)}})}},42575:(t,e,s)=>{s.d(e,{z:()=>a});var n=s(69610),r=s(41236),o=s(51838);class i extends Event{constructor(t,e){super(t),this.detail=e}}class a{constructor(t){this._isReady=!1,this._ready=new n.D,this._stopped=Promise.resolve(),this._execution_count=0,this._pendingInput=void 0,this._listeners=new Map,this._files=new Map,this._modules=new Map,this._options=this.clone(t),this._rootPath=t.rootPath}safeKernel(){return!1}version(){return r.x}language(){throw new o.EH("language")}languageName(){throw new o.EH("languageName")}moduleExts(){throw new o.EH("moduleExts")}get execution_count(){return this._execution_count}evalAsync(t,e,s,n=null){throw new o.EH("evalAsync")}async putFile(t,e){this._files.set(t,e)}async putModule(t,e){this._modules.set(t,e)}async userModules(){return[]}async getFile(t){throw new o.EH("getFile")}async getUserModuleFile(t){throw new o.EH("getUserModuleFile")}async more(t){throw new o.EH("more")}async complete(t){return[]}banner(){return`Welcome to the ${this.languageName()} REPL!`}ps1(){return">>> "}ps2(){return"... "}async _init(){}async init(){this.safeKernel()||console.warn("%c⚠ DANGER ⚠: this kernel is not safe! Please consider using a safe kernel.","color: red; font-size: 20px;");try{await this._init()}catch(t){throw this._ready.reject(t),t}this.addEventListener("eval.request",this.evalFromEvent.bind(this)),await this.start()}async _start(){}async start(){await this._stopped,this._execution_count=0;try{await this._start()}catch(t){throw this._ready.reject(t),t}this._files.forEach(((t,e)=>this.putFile(e,t))),this._modules.forEach(((t,e)=>this.putModule(e,t))),this._isReady=!0,this._ready.resolve()}async _stop(){}stop(){this._isReady=!1,this._ready=new n.D,this._stopped=this._stop()}restart(){this.stop(),this.start()}get isReady(){return this._isReady}async ready(){return this._ready.promise}assetsURL(t=!1){let e=this._rootPath;if(t&&!e.startsWith("http")){const t=window.location.origin+window.location.pathname;e=t.substring(0,t.lastIndexOf("/"))+"/"+e}return e}basthonRoot(t=!1){return this.assetsURL(t)+"/"+this.version()+"/"+this.language()}download(t,e){if(!("string"==typeof t||t instanceof String)){const e=new Blob([t],{type:"application/octet-stream"});t=window.URL.createObjectURL(e)}const s=document.createElement("a");s.download=e,s.href=t,s.target="_blank",s.style.display="none",document.body.appendChild(s),s.click(),document.body.removeChild(s)}dispatchEvent(t,e){document.dispatchEvent(new i(`basthon.${t}`,e))}addEventListener(t,e){const s=t=>e(t.detail);document.addEventListener(`basthon.${t}`,s);let n=this._listeners.get(t);null==n&&(n=new Map,this._listeners.set(t,n)),n.set(e,s)}removeEventListener(t,e){const s=this._listeners.get(t);document.removeEventListener(`basthon.${t}`,s?.get(e))}async inputAsync(t,e=!1,s=void 0){(s=this.clone(s)).content={prompt:t,password:e};const r=new n.D;s.resolve=r.resolve.bind(r),s.reject=r.reject.bind(r),this._pendingInput=r,this.dispatchEvent("eval.input",s);const o=await r.promise;return this._pendingInput=void 0,o}resolvePendingInput(){this._pendingInput?.resolve("")}clone(t){return JSON.parse(JSON.stringify(t))}async putRessource(t,e){const s=t.split(".").pop()??"";return this.moduleExts().includes(s)?await this.putModule(t,e):await this.putFile(t,e)}pendingInput(){return null!=this._pendingInput}async evalFromEvent(t){const e=e=>s=>{let n=this.clone(t);n.stream=e,n.content=s,this.dispatchEvent("eval.output",n)},s=e("stdout"),n=e("stderr");let r;try{r=await this.evalAsync(t.code,s,n,t)}catch(e){n(e.toString());const s=this.clone(t);return s.error=e,s.execution_count=this.execution_count,void this.dispatchEvent("eval.error",s)}if(null==r)return;const o=r[0],i=r[1];let a=this.clone(t);a.execution_count=i,null!=o&&(a.result=o),this.dispatchEvent("eval.finished",a)}}},41236:(t,e,s)=>{s.d(e,{x:()=>n});const n="0.73.5"},90719:(t,e,s)=>{s.d(e,{EchoKernel:()=>r});var n=s(42575);class r extends n.z{constructor(t){super(t)}language(){return"echo"}languageName(){return"Echo"}moduleExts(){return[]}ps1(){return"echo> "}ps2(){return"...> "}async more(t){return!1}async evalAsync(t,e,s,n=null){return n.interactive=!0,this._execution_count++,e(t+"\n"),[void 0,this._execution_count]}}}}]);
//# sourceMappingURL=719.596711fac93aae2143cb.js.map